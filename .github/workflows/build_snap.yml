name: Snapパッケージのビルド
run-name: Building Miria's Snap package
on: [workflow_dispatch]
jobs:
  build:
    name: ビルド（Snap）
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Build snap
        uses: snapcore/action-build@v1
        id: snapcraft

      - name: Get Build Version
        run: |
          sudo snap install flutter --classic
          flutter pub get
          echo "VERSION=$(flutter pub run cider version)" >> $GITHUB_ENV  
          
      - name: Create release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh release create v$VERSION --generate-notes --draft ${{ steps.snapcraft.outputs.snap }}

      # https://github.com/snapcore/action-publish
      # 以下をコメントアウトすることでSnap Storeへのアップロードすることが可能です。
      #- name: Upload snap store
      #  uses: snapcore/action-publish@v1
      #  env:
      #    SNAPCRAFT_STORE_CREDENTIALS: ${{ secrets.STORE_LOGIN }}
      #  with:
      #    snap: ${{ steps.snapcraft.outputs.snap }}
      #    release: edge
